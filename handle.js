var handle=function(w,k){function q(a){a=a||w.event;var b=a.target||a.srcElement,c="keydown"==a.type,l=b.id,e=(b.nodeName||"").toLowerCase(),b=b.type,g=(c?a.shiftKey<<2:0)^a.ctrlKey<<1^a.altKey,c=(a.keyCode||a.which)<<4^c<<3^g,d;if(g||("input"!=e||"password"!=b&&"text"!=b)&&"textarea"!=e)(d=r[l])&&(d=d[c])&&(d(a),1)||(d=m[c])&&(d(a),1)||(d=t[c])&&d(a)}var u=k.addEventListener||k.attachEvent&&function(a,b){k.attachEvent("on"+a,b,!1)},n,r={},m={},t={},p={SPACE:32,ENTER:13,TAB:9,BACKSPACE:8,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,HOME:36,END:35,PAGEUP:33,PAGEDOWN:34,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},v={GLOBAL:0,STATE:1,SHIFT:4,CTRL:2,ALT:1,key:function(a,b,c,l){var e=p[b.toUpperCase()],g=e||l&3?1:0,d,h="string"==typeof a?a:0,f=a?m:t;h&&(f=r,f=f[h]||(f[h]={}));e||(e=b[g?"toUpperCase":"toLowerCase"]().charCodeAt(0));d=e<<4^g<<3^l;f[d]=c;return function(){f[h?h:d]=null}},click:function(a,b){var c=k.getElementById(a)||{};c.onclick=b;c.ontouchstart=function(a){a.preventDefault();b()};return function(){c.onclick=c.ontouchstart=null}},newState:function(){m={}}};for(n in p)v[n]=p[n];u("keydown",q);u("keypress",q);return v}(window,document);
