var handle=function(v,d){function n(a){a=a||v.event;var b=a.target||a.srcElement,c="keydown"==a.type,f=b.id,p=(b.nodeName||"").toLowerCase(),b=b.type,d=(c?a.shiftKey<<2:0)^a.ctrlKey<<1^a.altKey,c=(a.keyCode||a.which)<<4^c<<3^d,e;if(d||("input"!=p||"password"!=b&&"text"!=b)&&"textarea"!=p)(e=q[f])&&(e=e[c])&&(e(a),1)||(e=l[c])&&(e(a),1)||(e=r[c])&&e(a)}var g,t=d.addEventListener||d.attachEvent&&function(a,b){d.attachEvent("on"+a,b)},q={},l={},r={},m={SPACE:32,ENTER:13,TAB:9,BACKSPACE:8,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,HOME:36,END:35,PAGEUP:33,PAGEDOWN:34,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},u={GLOBAL:0,STATE:1,SHIFT:4,CTRL:2,ALT:1,key:function(a,b,c,f){var d=m[b.toUpperCase()],g=d||f&3?1:0,e,k="string"==typeof a?a:0,h=a?l:r;k&&(h=q,h=h[k]||(h[k]={}));d||(d=b[g?"toUpperCase":"toLowerCase"]().charCodeAt(0));e=d<<4^g<<3^f;h[e]=c;return function(){h[k?k:e]=null}},click:function(a,b){var c=d.getElementById(a)||{};c.onclick=b;c.ontouchstart=function(a){a.preventDefault();b(a)};return function(){c.onclick=c.ontouchstart=null}},on:function(a,b,c){var f=d.getElementById(a)||{};f["on"+b]=c;return function(){f["on"+b]=null}},newState:function(){l={}}};for(g in m)u[g]=m[g];t("keydown",n);t("keypress",n);return u}(window,document);
